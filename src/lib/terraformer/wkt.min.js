(function(e,t){typeof module=="object"&&typeof module.exports=="object"&&(exports=module.exports=t()),typeof define=="function"&&define.amd&&define(["terraformer/terraformer"],t),typeof navigator=="object"&&(typeof e.Terraformer=="undefined"&&(e.Terraformer={}),e.Terraformer.WKT=t())})(this,function(){function r(e){var t=[],n="";for(var r=0;r<e.length;r++)t.push(e[r].join(" "));return n+="("+t.join(", ")+")",n}function i(e){var t="POINT ";return e.coordinates===undefined||e.coordinates.length===0?(t+="EMPTY",t):(e.coordinates.length===3?e.properties.m===!0?t+="M ":t+="Z ":e.coordinates.length===4&&(t+="ZM "),t+="("+e.coordinates.join(" ")+")",t)}function s(e){var t="LINESTRING ";return e.coordinates===undefined||e.coordinates.length===0||e.coordinates[0].length===0?(t+="EMPTY",t):(e.coordinates[0][0].length===3?e.properties.m===!0?t+="M ":t+="Z ":e.coordinates[0][0].length===4&&(t+="ZM "),t+=r(e.coordinates),t)}function o(e){var t="POLYGON ";if(e.coordinates===undefined||e.coordinates.length===0||e.coordinates[0].length===0)return t+="EMPTY",t;e.coordinates[0][0].length===3?e.properties.m===!0?t+="M ":t+="Z ":e.coordinates[0][0].length===4&&(t+="ZM "),t+="(";var n=[];for(var i=0;i<e.coordinates.length;i++)n.push(r(e.coordinates[i]));return t+=n.join(", "),t+=")",t}function u(e){var t="MULTIPOINT ";return e.coordinates===undefined||e.coordinates.length===0||e.coordinates[0].length===0?(t+="EMPTY",t):(e.coordinates[0][0].length===3?e.properties.m===!0?t+="M ":t+="Z ":e.coordinates[0][0].length===4&&(t+="ZM "),t+=r(e.coordinates),t)}function a(e){var t="MULTILINESTRING ";if(e.coordinates===undefined||e.coordinates.length===0||e.coordinates[0].length===0)return t+="EMPTY",t;e.coordinates[0][0].length===3?e.properties.m===!0?t+="M ":t+="Z ":e.coordinates[0][0].length===4&&(t+="ZM "),t+="(";var n=[];for(var i=0;i<e.coordinates.length;i++)n.push(r(e.coordinates[i]));return t+=n.join(", "),t+=")",t}function f(e){var t="MULTIPOLYGON ";if(e.coordinates===undefined||e.coordinates.length===0||e.coordinates[0].length===0)return t+="EMPTY",t;e.coordinates[0][0][0].length===3?e.properties.m===!0?t+="M ":t+="Z ":e.coordinates[0][0][0].length===4&&(t+="ZM "),t+="(";var n=[];for(var i=0;i<e.coordinates.length;i++){var s="(",o=[];for(var u=0;u<e.coordinates[i].length;u++)o.push(r(e.coordinates[i][u]));s+=o.join(", "),s+=")",n.push(s)}return t+=n.join(", "),t+=")",t}function l(e){switch(e.type){case"Point":return i(e);case"LineString":return s(e);case"Polygon":return o(e);case"MultiPoint":return u(e);case"MultiLineString":return a(e);case"MultiPolygon":return f(e);default:throw Error("Unknown Type: "+e.type)}}function c(e){this.data=[e],this.type="PointArray"}function h(e){this.data=e,this.type="Ring"}function p(e){this.data=[e],this.type="RingList"}function d(e){this.data=[e],this.type="PolygonList"}function v(){return n.parse.apply(n,arguments)}function m(e){var r,i;try{r=n.parse(e)}catch(s){throw console.dir(s),Error("Unable to parse",s)}return t.Primitive(r)}var e={},t;typeof this.navigator=="object"&&(t=this.Terraformer),typeof module=="object"&&typeof module.exports=="object"&&(t=require("terraformer")),arguments[0]&&typeof define=="function"&&define.amd&&(t=arguments[0]);var n=function(){function n(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,expressions:3,point:4,EOF:5,linestring:6,polygon:7,multipoint:8,multilinestring:9,multipolygon:10,coordinate:11,DOUBLE_TOK:12,ptarray:13,COMMA:14,ring_list:15,ring:16,"(":17,")":18,POINT:19,Z:20,M:21,EMPTY:22,point_untagged:23,polygon_list:24,polygon_untagged:25,point_list:26,LINESTRING:27,POLYGON:28,MULTIPOINT:29,MULTILINESTRING:30,MULTIPOLYGON:31,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",12:"DOUBLE_TOK",14:"COMMA",17:"(",18:")",19:"POINT",20:"Z",21:"M",22:"EMPTY",27:"LINESTRING",28:"POLYGON",29:"MULTIPOINT",30:"MULTILINESTRING",31:"MULTIPOLYGON"},productions_:[0,[3,2],[3,2],[3,2],[3,2],[3,2],[3,2],[11,2],[11,3],[11,4],[13,3],[13,1],[15,3],[15,1],[16,3],[4,4],[4,5],[4,6],[4,5],[4,2],[23,1],[23,3],[24,3],[24,1],[25,3],[26,3],[26,1],[6,4],[6,5],[6,5],[6,6],[6,2],[7,4],[7,5],[7,5],[7,6],[7,2],[8,4],[8,5],[8,5],[8,6],[8,2],[9,4],[9,5],[9,5],[9,6],[9,2],[10,4],[10,5],[10,5],[10,6],[10,2]],performAction:function(t,n,r,i,s,o,u){var a=o.length-1;switch(s){case 1:return o[a-1];case 2:return o[a-1];case 3:return o[a-1];case 4:return o[a-1];case 5:return o[a-1];case 6:return o[a-1];case 7:this.$=new c([Number(o[a-1]),Number(o[a])]);break;case 8:this.$=new c([Number(o[a-2]),Number(o[a-1]),Number(o[a])]);break;case 9:this.$=new c([Number(o[a-3]),Number(o[a-2]),Number(o[a-1]),Number(o[a])]);break;case 10:this.$=o[a-2].addPoint(o[a]);break;case 11:this.$=o[a];break;case 12:this.$=o[a-2].addRing(o[a]);break;case 13:this.$=new p(o[a]);break;case 14:this.$=new h(o[a-1]);break;case 15:this.$={type:"Point",coordinates:o[a-1].data[0]};break;case 16:this.$={type:"Point",coordinates:o[a-2].data[0],properties:{z:!0}};break;case 17:this.$={type:"Point",coordinates:o[a-3].data[0],properties:{z:!0,m:!0}};break;case 18:this.$={type:"Point",coordinates:o[a-2].data[0],properties:{m:!0}};break;case 19:this.$={type:"Point",coordinates:[]};break;case 20:this.$=o[a];break;case 21:this.$=o[a-1];break;case 22:this.$=o[a-2].addPolygon(o[a]);break;case 23:this.$=new d(o[a]);break;case 24:this.$=o[a-1];break;case 25:this.$=o[a-2].addPoint(o[a]);break;case 26:this.$=o[a];break;case 27:this.$={type:"LineString",coordinates:o[a-1].data};break;case 28:this.$={type:"LineString",coordinates:o[a-2].data,properties:{z:!0}};break;case 29:this.$={type:"LineString",coordinates:o[a-2].data,properties:{m:!0}};break;case 30:this.$={type:"LineString",coordinates:o[a-3].data,properties:{z:!0,m:!0}};break;case 31:this.$={type:"LineString",coordinates:[]};break;case 32:this.$={type:"Polygon",coordinates:o[a-1].toJSON()};break;case 33:this.$={type:"Polygon",coordinates:o[a-2].toJSON(),properties:{z:!0}};break;case 34:this.$={type:"Polygon",coordinates:o[a-2].toJSON(),properties:{m:!0}};break;case 35:this.$={type:"Polygon",coordinates:o[a-3].toJSON(),properties:{z:!0,m:!0}};break;case 36:this.$={type:"Polygon",coordinates:[]};break;case 37:this.$={type:"MultiPoint",coordinates:o[a-1].data};break;case 38:this.$={type:"MultiPoint",coordinates:o[a-2].data,properties:{z:!0}};break;case 39:this.$={type:"MultiPoint",coordinates:o[a-2].data,properties:{m:!0}};break;case 40:this.$={type:"MultiPoint",coordinates:o[a-3].data,properties:{z:!0,m:!0}};break;case 41:this.$={type:"MultiPoint",coordinates:[]};break;case 42:this.$={type:"MultiLineString",coordinates:o[a-1].toJSON()};break;case 43:this.$={type:"MultiLineString",coordinates:o[a-2].toJSON(),properties:{z:!0}};break;case 44:this.$={type:"MultiLineString",coordinates:o[a-2].toJSON(),properties:{m:!0}};break;case 45:this.$={type:"MultiLineString",coordinates:o[a-3].toJSON(),properties:{z:!0,m:!0}};break;case 46:this.$={type:"MultiLineString",coordinates:[]};break;case 47:this.$={type:"MultiPolygon",coordinates:o[a-1].toJSON()};break;case 48:this.$={type:"MultiPolygon",coordinates:o[a-2].toJSON(),properties:{z:!0}};break;case 49:this.$={type:"MultiPolygon",coordinates:o[a-2].toJSON(),properties:{m:!0}};break;case 50:this.$={type:"MultiPolygon",coordinates:o[a-3].toJSON(),properties:{z:!0,m:!0}};break;case 51:this.$={type:"MultiPolygon",coordinates:[]}}},table:[{3:1,4:2,6:3,7:4,8:5,9:6,10:7,19:[1,8],27:[1,9],28:[1,10],29:[1,11],30:[1,12],31:[1,13]},{1:[3]},{5:[1,14]},{5:[1,15]},{5:[1,16]},{5:[1,17]},{5:[1,18]},{5:[1,19]},{17:[1,20],20:[1,21],21:[1,22],22:[1,23]},{17:[1,24],20:[1,25],21:[1,26],22:[1,27]},{17:[1,28],20:[1,29],21:[1,30],22:[1,31]},{17:[1,32],20:[1,33],21:[1,34],22:[1,35]},{17:[1,36],20:[1,37],21:[1,38],22:[1,39]},{17:[1,40],20:[1,41],21:[1,42],22:[1,43]},{1:[2,1]},{1:[2,2]},{1:[2,3]},{1:[2,4]},{1:[2,5]},{1:[2,6]},{11:45,12:[1,46],13:44},{17:[1,47],21:[1,48]},{17:[1,49]},{5:[2,19]},{11:52,12:[1,46],17:[1,53],23:51,26:50},{17:[1,54],21:[1,55]},{17:[1,56]},{5:[2,31]},{15:57,16:58,17:[1,59]},{17:[1,60],21:[1,61]},{17:[1,62]},{5:[2,36]},{11:52,12:[1,46],17:[1,53],23:51,26:63},{17:[1,64],21:[1,65]},{17:[1,66]},{5:[2,41]},{15:67,16:58,17:[1,59]},{17:[1,68],21:[1,69]},{17:[1,70]},{5:[2,46]},{17:[1,73],24:71,25:72},{17:[1,74],21:[1,75]},{17:[1,76]},{5:[2,51]},{14:[1,78],18:[1,77]},{14:[2,11],18:[2,11]},{12:[1,79]},{11:45,12:[1,46],13:80},{17:[1,81]},{11:45,12:[1,46],13:82},{14:[1,84],18:[1,83]},{14:[2,26],18:[2,26]},{14:[2,20],18:[2,20]},{11:85,12:[1,46]},{11:52,12:[1,46],17:[1,53],23:51,26:86},{17:[1,87]},{11:52,12:[1,46],17:[1,53],23:51,26:88},{14:[1,90],18:[1,89]},{14:[2,13],18:[2,13]},{11:45,12:[1,46],13:91},{15:92,16:58,17:[1,59]},{17:[1,93]},{15:94,16:58,17:[1,59]},{14:[1,84],18:[1,95]},{11:52,12:[1,46],17:[1,53],23:51,26:96},{17:[1,97]},{11:52,12:[1,46],17:[1,53],23:51,26:98},{14:[1,90],18:[1,99]},{15:100,16:58,17:[1,59]},{17:[1,101]},{15:102,16:58,17:[1,59]},{14:[1,104],18:[1,103]},{14:[2,23],18:[2,23]},{15:105,16:58,17:[1,59]},{17:[1,73],24:106,25:72},{17:[1,107]},{17:[1,73],24:108,25:72},{5:[2,15]},{11:109,12:[1,46]},{12:[1,110],14:[2,7],18:[2,7]},{14:[1,78],18:[1,111]},{11:45,12:[1,46],13:112},{14:[1,78],18:[1,113]},{5:[2,27]},{11:52,12:[1,46],17:[1,53],23:114},{18:[1,115]},{14:[1,84],18:[1,116]},{11:52,12:[1,46],17:[1,53],23:51,26:117},{14:[1,84],18:[1,118]},{5:[2,32]},{16:119,17:[1,59]},{14:[1,78],18:[1,120]},{14:[1,90],18:[1,121]},{15:122,16:58,17:[1,59]},{14:[1,90],18:[1,123]},{5:[2,37]},{14:[1,84],18:[1,124]},{11:52,12:[1,46],17:[1,53],23:51,26:125},{14:[1,84],18:[1,126]},{5:[2,42]},{14:[1,90],18:[1,127]},{15:128,16:58,17:[1,59]},{14:[1,90],18:[1,129]},{5:[2,47]},{17:[1,73],25:130},{14:[1,90],18:[1,131]},{14:[1,104],18:[1,132]},{17:[1,73],24:133,25:72},{14:[1,104],18:[1,134]},{14:[2,10],18:[2,10]},{12:[1,135],14:[2,8],18:[2,8]},{5:[2,16]},{14:[1,78],18:[1,136]},{5:[2,18]},{14:[2,25],18:[2,25]},{14:[2,21],18:[2,21]},{5:[2,28]},{14:[1,84],18:[1,137]},{5:[2,29]},{14:[2,12],18:[2,12]},{14:[2,14],18:[2,14]},{5:[2,33]},{14:[1,90],18:[1,138]},{5:[2,34]},{5:[2,38]},{14:[1,84],18:[1,139]},{5:[2,39]},{5:[2,43]},{14:[1,90],18:[1,140]},{5:[2,44]},{14:[2,22],18:[2,22]},{14:[2,24],18:[2,24]},{5:[2,48]},{14:[1,104],18:[1,141]},{5:[2,49]},{14:[2,9],18:[2,9]},{5:[2,17]},{5:[2,30]},{5:[2,35]},{5:[2,40]},{5:[2,45]},{5:[2,50]}],defaultActions:{14:[2,1],15:[2,2],16:[2,3],17:[2,4],18:[2,5],19:[2,6],23:[2,19],27:[2,31],31:[2,36],35:[2,41],39:[2,46],43:[2,51],77:[2,15],83:[2,27],89:[2,32],95:[2,37],99:[2,42],103:[2,47],111:[2,16],113:[2,18],116:[2,28],118:[2,29],121:[2,33],123:[2,34],124:[2,38],126:[2,39],127:[2,43],129:[2,44],132:[2,48],134:[2,49],136:[2,17],137:[2,30],138:[2,35],139:[2,40],140:[2,45],141:[2,50]},parseError:function(t,n){throw new Error(t)},parse:function(t){function v(e){r.length=r.length-2*e,i.length=i.length-e,s.length=s.length-e}function m(){var e;return e=n.lexer.lex()||1,typeof e!="number"&&(e=n.symbols_[e]||e),e}var n=this,r=[0],i=[null],s=[],o=this.table,u="",a=0,f=0,l=0,c=2,h=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var p=this.lexer.yylloc;s.push(p);var d=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var g,y,b,w,E,S,x={},T,N,C,k;for(;;){b=r[r.length-1];if(this.defaultActions[b])w=this.defaultActions[b];else{if(g===null||typeof g=="undefined")g=m();w=o[b]&&o[b][g]}if(typeof w=="undefined"||!w.length||!w[0]){var L="";if(!l){k=[];for(T in o[b])this.terminals_[T]&&T>2&&k.push("'"+this.terminals_[T]+"'");this.lexer.showPosition?L="Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+k.join(", ")+", got '"+(this.terminals_[g]||g)+"'":L="Parse error on line "+(a+1)+": Unexpected "+(g==1?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(L,{text:this.lexer.match,token:this.terminals_[g]||g,line:this.lexer.yylineno,loc:p,expected:k})}}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+b+", token: "+g);switch(w[0]){case 1:r.push(g),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),r.push(w[1]),g=null,y?(g=y,y=null):(f=this.lexer.yyleng,u=this.lexer.yytext,a=this.lexer.yylineno,p=this.lexer.yylloc,l>0&&l--);break;case 2:N=this.productions_[w[1]][1],x.$=i[i.length-N],x._$={first_line:s[s.length-(N||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(N||1)].first_column,last_column:s[s.length-1].last_column},d&&(x._$.range=[s[s.length-(N||1)].range[0],s[s.length-1].range[1]]),S=this.performAction.call(x,u,f,a,this.yy,w[1],i,s);if(typeof S!="undefined")return S;N&&(r=r.slice(0,-1*N*2),i=i.slice(0,-1*N),s=s.slice(0,-1*N)),r.push(this.productions_[w[1]][0]),i.push(x.$),s.push(x._$),C=o[r[r.length-2]][r[r.length-1]],r.push(C);break;case 3:return!0}}return!0}};undefined;var t=function(){var e={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,n)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=(new Array(e.length+1)).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,r,i,s;this._more||(this.yytext="",this.match="");var o=this._currentRules();for(var u=0;u<o.length;u++){n=this._input.match(this.rules[o[u]]);if(n&&(!t||n[0].length>t[0].length)){t=n,r=u;if(!this.options.flex)break}}if(t){s=t[0].match(/(?:\r\n?|\n).*/g),s&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,o[r],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1);if(e)return e;return}return this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return typeof t!="undefined"?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return e.options={},e.performAction=function(t,n,r,i){var s=i;switch(r){case 0:break;case 1:return 17;case 2:return 18;case 3:return 12;case 4:return 19;case 5:return 27;case 6:return 28;case 7:return 29;case 8:return 30;case 9:return 31;case 10:return 14;case 11:return 22;case 12:return 21;case 13:return 20;case 14:return 5;case 15:return"INVALID"}},e.rules=[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:-?[0-9]+(\.[0-9]+)?)/,/^(?:POINT\b)/,/^(?:LINESTRING\b)/,/^(?:POLYGON\b)/,/^(?:MULTIPOINT\b)/,/^(?:MULTILINESTRING\b)/,/^(?:MULTIPOLYGON\b)/,/^(?:,)/,/^(?:EMPTY\b)/,/^(?:M\b)/,/^(?:Z\b)/,/^(?:$)/,/^(?:.)/],e.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],inclusive:!0}},e}();return e.lexer=t,n.prototype=e,e.Parser=n,new n}();return e.convert=l,c.prototype.addPoint=function(e){return e.type==="PointArray"?this.data=this.data.concat(e.data):this.data.push(e),this},c.prototype.toJSON=function(){return this.data},h.prototype.toJSON=function(){var e=[];for(var t=0;t<this.data.data.length;t++)e.push(this.data.data[t]);return e},p.prototype.addRing=function(e){return this.data.push(e),this},p.prototype.toJSON=function(){var e=[];for(var t=0;t<this.data.length;t++)e.push(this.data[t].toJSON());return e.length===1?e:e},d.prototype.addPolygon=function(e){return this.data.push(e),this},d.prototype.toJSON=function(){var e=[];for(var t=0;t<this.data.length;t++)e=e.concat([this.data[t].toJSON()]);return e.length===1?e:e},e.parser=n,e.Parser=n.Parser,e.parse=m,e});